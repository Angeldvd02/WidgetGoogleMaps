<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa con Google Maps</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h2>Ubicaci√≥n en Google Maps</h2>
    <div id="map" style="height: 500px; width: 100%;"></div>

    <script>
        const GOOGLE_MAPS_API_KEY = "AIzaSyAPGd6YugcQP6Sxj9lgPwPejKD-vWDkFMY"; // Reempl√°zala con tu clave de Google Maps
        const DEFAULT_ADDRESS = "Calle 77 # 59-35, Barranquilla, Colombia";
        let map, marker;

        // Funci√≥n para cargar Google Maps de forma as√≠ncrona
        function loadGoogleMaps() {
            return new Promise((resolve, reject) => {
                if (window.google && window.google.maps) {
                    resolve();
                    return;
                }

                const script = document.createElement("script");
                script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=onGoogleMapsLoaded`;
                script.async = true;
                script.defer = true;
                window.onGoogleMapsLoaded = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Funci√≥n para obtener coordenadas desde una direcci√≥n
        async function geocodeAddress(address) {
            try {
                const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${GOOGLE_MAPS_API_KEY}`);
                const data = await response.json();

                if (data.status === "OK") {
                    const location = data.results[0].geometry.location;
                    console.log("Coordenadas obtenidas:", location.lat, location.lng);
                    return location;
                } else {
                    console.error("Error en la geocodificaci√≥n:", data.status);
                    return null;
                }
            } catch (error) {
                console.error("Error en la solicitud a la API de Google Maps:", error);
                return null;
            }
        }

        // Funci√≥n para inicializar el mapa con coordenadas din√°micas
        function initMap(lat, lng) {
            if (!lat || !lng) {
                console.error("No se recibieron coordenadas v√°lidas.");
                return;
            }

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: lat, lng: lng },
                zoom: 15
            });

            marker = new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: map,
                title: "Ubicaci√≥n"
            });

            console.log("Mapa y marcador renderizados correctamente.");
        }

        // Ejecutar el flujo completo
        async function renderMap() {
            await loadGoogleMaps(); // Cargar Google Maps primero
            const location = await geocodeAddress(DEFAULT_ADDRESS); // Obtener coordenadas

            if (location) {
                initMap(location.lat, location.lng); // Inicializar el mapa con las coordenadas obtenidas
            } else {
                console.error("No se pudo obtener una ubicaci√≥n v√°lida.");
            }
        }

        // Ejecutar la funci√≥n principal
        renderMap();
    </script>
</body>

</html>

<!-- con zoho -->


<!-- <!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa en Zoho CRM</title>
    <script src="https://live.zwidgets.com/js-sdk/1.2/ZohoEmbededAppSDK.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h2>Ubicaci√≥n en Google Maps</h2>
    <div id="map" style="height: 500px; width: 100%;"></div>

    <script>
        const GOOGLE_MAPS_API_KEY = "AIzaSyAPGd6YugcQP6Sxj9lgPwPejKD-vWDkFMY"; // Reempl√°zala con tu clave de Google Maps
        const DEFAULT_ADDRESS = "Calle 77 # 59-35, Barranquilla, Colombia";
        let map, marker;

        // Funci√≥n para cargar Google Maps de forma as√≠ncrona
        function loadGoogleMaps() {
            return new Promise((resolve, reject) => {
                if (window.google && window.google.maps) {
                    resolve();
                    return;
                }

                const script = document.createElement("script");
                script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=onGoogleMapsLoaded`;
                script.async = true;
                script.defer = true;
                window.onGoogleMapsLoaded = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Funci√≥n para obtener coordenadas desde una direcci√≥n
        async function geocodeAddress(address) {
            try {
                const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${GOOGLE_MAPS_API_KEY}`);
                const data = await response.json();

                if (data.status === "OK") {
                    const location = data.results[0].geometry.location;
                    console.log("üìå Coordenadas obtenidas:", location.lat, location.lng);
                    return location;
                } else {
                    console.error("‚ùå Error en la geocodificaci√≥n:", data.status);
                    return null;
                }
            } catch (error) {
                console.error("‚ùå Error en la solicitud a la API de Google Maps:", error);
                return null;
            }
        }

        // Funci√≥n para inicializar el mapa con coordenadas din√°micas
        function initMap(lat, lng) {
            if (!lat || !lng) {
                console.error("‚ùå No se recibieron coordenadas v√°lidas.");
                return;
            }

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: lat, lng: lng },
                zoom: 15
            });

            marker = new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: map,
                title: "Ubicaci√≥n"
            });

            console.log("‚úÖ Mapa y marcador renderizados correctamente.");
        }

        // Funci√≥n principal para integrar Zoho y Google Maps
        async function renderMap() {
            await loadGoogleMaps(); // Cargar Google Maps primero

            // Esperar que Zoho est√© listo antes de obtener la direcci√≥n
            ZOHO.embeddedApp.on("PageLoad", async function (data) {
                console.log("üîπ Widget cargado con datos:", data);

                let direccion = DEFAULT_ADDRESS; // Valor por defecto

                try {
                    const field = await ZOHO.CRM.API.getRecord({ Entity: "Leads", RecordID: data.EntityId });
                    if (field?.data?.[0]?.Direccion) {
                        direccion = field.data[0].Direccion;
                        console.log("üìç Direcci√≥n obtenida de Zoho CRM:", direccion);
                    } else {
                        console.log("‚ö† No se encontr√≥ direcci√≥n en Zoho, usando la predeterminada.");
                    }
                } catch (error) {
                    console.error("‚ùå Error al obtener la direcci√≥n del CRM:", error);
                }

                // Obtener coordenadas y renderizar el mapa
                const location = await geocodeAddress(direccion);
                if (location) {
                    initMap(location.lat, location.lng);
                } else {
                    console.error("‚ùå No se pudo obtener una ubicaci√≥n v√°lida.");
                }
            });

            ZOHO.embeddedApp.init();
        }

        // Ejecutar el flujo completo
        renderMap();
    </script>
</body>

</html> -->
